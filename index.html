<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™šæ‹Ÿé’¢ç´</title>
    <script src="https://unpkg.com/midi-parser-js@4.0.4/src/midi-parser.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- å·¦ä¸Šè§’MIDIæ§åˆ¶ -->
    <div class="top-midi-controls">
        <input type="file" id="midiFileInput" accept=".mid,.midi" style="display: none;">
        <button class="control-icon" id="midiLoadBtn" title="å¯¼å…¥MIDIæ–‡ä»¶">ğŸ“</button>
        <button class="control-icon" id="midiPlayBtn" title="æ’­æ”¾/æš‚åœ" disabled>â¯ï¸</button>
        <button class="control-icon" id="midiStopBtn" title="åœæ­¢" disabled>â¸ï¸</button>
        <div class="midi-speed-control">
            <button class="control-icon" id="midiSpeedIcon" title="MIDIæ’­æ”¾é€Ÿåº¦">ğŸ›ï¸</button>
            <div class="vertical-slider-panel" id="midiSpeedPanel">
                <label>é€Ÿåº¦</label>
                <input type="range" id="midiSpeedControl" class="vertical-slider" min="0.5" max="2.0" value="1" step="0.1" orient="vertical">
                <span id="midiSpeedDisplay">1.0x</span>
            </div>
        </div>
    </div>

    <div class="scroll-container">
        <div id="piano">
            <!-- ç´é”®å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- åº•éƒ¨è®¾ç½®æ  -->
    <div class="bottom-settings-bar">
        <!-- æ»šåŠ¨çµæ•åº¦æ§åˆ¶å™¨ -->
        <div class="scroll-sensitivity-control">
            <button class="control-icon" id="scrollIcon" title="æ»šåŠ¨çµæ•åº¦ï¼ˆçµæ•åº¦è°ƒèŠ‚å»ºè®®ä½¿ç”¨é¼ æ ‡æ»šè½®ï¼‰">ğŸ–±ï¸</button>
            <div class="vertical-slider-panel" id="scrollPanel">
                <label>çµæ•åº¦</label>
                <input type="range" id="scrollSensitivity" class="vertical-slider" min="0.1" max="3" value="1" step="0.1" orient="vertical">
            </div>
        </div>

        <!-- éŸ³é‡æ§åˆ¶å™¨ -->
        <div class="volume-control">
            <button class="control-icon" id="volumeIcon" title="éŸ³é‡">ğŸ”Š</button>
            <div class="vertical-slider-panel" id="volumePanel">
                <label>éŸ³é‡</label>
                <input type="range" id="volumeControl" class="vertical-slider" min="0" max="1" value="1" step="0.05" orient="vertical">
            </div>
        </div>

        <!-- é”®ç›˜å°ºå¯¸æ§åˆ¶å™¨ -->
        <div class="keyboard-size-control">
            <button class="control-icon" id="sizeIcon" title="é”®ç›˜å°ºå¯¸ (å½“å‰: 1.2ï¼Œè°ƒèŠ‚ä¸º1æ—¶å…¨å±å¯æ˜¾ç¤ºæ‰€æœ‰ç´é”®)">ğŸ“</button>
            <div class="vertical-slider-panel" id="sizePanel">
                <label>å°ºå¯¸</label>
                <input type="range" id="keyboardSizeControl" class="vertical-slider" min="0.5" max="2.0" value="1.2" step="0.1" orient="vertical">
            </div>
        </div>

        <!-- é”®ç›˜æ˜ å°„æ˜¾ç¤ºå¼€å…³ -->
        <div class="keyboard-mapping-toggle">
            <label for="showKeyboardMapping">æ˜¾ç¤ºé”®ç›˜æ˜ å°„</label>
            <input type="checkbox" id="showKeyboardMapping" checked>
        </div>

        <!-- éŸ³é«˜æ˜¾ç¤ºé€‰é¡¹ -->
        <div class="note-display-options">
            <label>éŸ³é«˜æ˜¾ç¤º</label>
            <div class="custom-select" id="noteDisplaySelect">
                <div class="custom-select-trigger">å®Œæ•´éŸ³é«˜</div>
                <div class="custom-select-options">
                    <div class="custom-select-option selected" data-value="full">å®Œæ•´éŸ³é«˜</div>
                    <div class="custom-select-option" data-value="nameOnly">åªæ˜¾ç¤ºéŸ³å</div>
                    <div class="custom-select-option" data-value="none">ä¸æ˜¾ç¤º</div>
                </div>
            </div>
        </div>

        <!-- ç´é”®æ•ˆæœé€‰é¡¹ -->
        <div class="key-effect-options">
            <label>ç´é”®æ•ˆæœ</label>
            <div class="custom-select" id="keyEffectSelect">
                <div class="custom-select-trigger">é¢œè‰²+åŠ¨ç”»</div>
                <div class="custom-select-options">
                    <div class="custom-select-option selected" data-value="colorAndAnimation">é¢œè‰²+åŠ¨ç”»</div>
                    <div class="custom-select-option" data-value="colorOnly">åªæœ‰é¢œè‰²</div>
                    <div class="custom-select-option" data-value="none">é»˜è®¤æ•ˆæœ</div>
                </div>
            </div>
        </div>


    </div>

    <!-- JavaScript æ–‡ä»¶ -->
    <script src="js/piano.js"></script>
    <script src="js/midi.js"></script>
    <script src="js/ui.js"></script>
    <script>
        // ç­‰å¾…DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('MIDIè§£æå™¨çŠ¶æ€:', window.MidiParser ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
            
            const piano = new Piano();
            const midiPlayer = new MidiPlayer(piano);
            const uiController = new UIController(piano, midiPlayer);
        });
    </script>
</body>

</html>